<<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>demo chat</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="" />
  </head>
  <body>
    <form id="msgForm">
      <input type="text" id="msg" />
      <button type="submit">Submit form</button>
    </form>
    <div id="history"></messages>

    <script>
      window.addEventListener("DOMContentLoaded", (event) => {
        console.log("DOM fully loaded and parsed");

        const getMessage = ()=>{
            fetch("/messages").then(data=>{
                return data.json()
            }).then(res=>{
                console.log(res)
                res.forEach(element => {
                    addMessage(element.name, element.messages)
                });
            })
        }

        const postMessage = (name, msg)=>{
            let data = {
                name: name,
                messages: msg
            }
            let config = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            }
            fetch("/messages", config).then(data=>{
                console.log(data)
            }).then(res=>{
                
            })
        }

        getMessage()
        const form = document.getElementById("msgForm");
        const msg = document.getElementById("msg");
        form.addEventListener("submit", (e) => {
          console.log("Submit");
          e.preventDefault();
          console.log(msg.value);
          addMessage("mita", msg.value)
          postMessage("mita", msg.value)
          msg.value = "";
        });


        const addMessage = (user, message) => {
            
            const msg = document.getElementById("history");
            const div = document.createElement('div')
            div.append(`${user}: ${message}`);
            msg.append(div)
        }
      });
    </script>

  </body>
</html>
